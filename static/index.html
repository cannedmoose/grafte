<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title></title>
  <link rel="stylesheet" href="./styles.css">
  <script type="text/javascript" src="elm.js"></script>
</head>

<body>
</body>

<script type="text/javascript">
let  app = Elm.Main.init(
  { flags:{}});

let mouseCoords = {x : 0, y: 0}
let shape = []
let ctx = undefined;
let canvas = undefined;

app.ports.draw.subscribe(function(data) {
  shape = data.reverse();
  window.requestAnimationFrame(render);
});

app.ports.draw2.subscribe(function(data) {
  mouseCoords = data
  window.requestAnimationFrame(render);
});

function render(delta) {
  if (!canvas || !ctx) {
    canvas = document.querySelector("canvas")
    ctx = canvas.getContext("2d");
  }
  if (shape.lenth == 0) {
    return;
  }
  console.log("render", mouseCoords,  shape);
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  ctx.fillStyle = "red"
  //ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.save();

  // Draw lines
  for (let i = 0; i < shape.length; i++) {
    ctx.strokeStyle = "black";
    let segment = shape[i];
    if(segment.type == "move") {
      ctx.moveTo(segment.coords.x, segment.coords.y) 
    } else {
      ctx.lineTo(segment.coords.x, segment.coords.y)
    }
    ctx.stroke();    
  }

  // Draw line to mouse
  let lastShape = shape[shape.length-1]
  ctx.moveTo(lastShape.coords.x, lastShape.coords.y)
  ctx.lineTo(mouseCoords.x, mouseCoords.y)
  ctx.strokeStyle = "blue";
  ctx.stroke()

  // Draw controls

  ctx.restore();
}

</script>

</html>